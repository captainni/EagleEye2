import{_ as M,N as H}from"./axios-c1489369.js";import{d as $,m as g,j,o as n,c as d,a as e,g as b,t as x,F as C,l as U,p as f,C as w,D as K,k as Q,i as R,G as W,f as X,e as k,w as N,h as B,z as S,T as Y,H as Z,s as O,b as _,x as h,v as ee}from"./index-095c05da.js";import{a as P}from"./request-203a8186.js";const q=()=>P.get("/v1/settings/all"),te=p=>P.post("/v1/settings/products",p),se=p=>P.put(`/v1/settings/products/${p.id}`,p),oe=p=>P.delete(`/v1/settings/products/${p}`),re=p=>P.post("/v1/settings/push",p),ae={class:"bg-white rounded-lg shadow-sm p-6 mb-6"},ne={key:0,class:"text-center text-gray-500"},le={key:1,class:"text-center text-red-500"},de={key:2},ie={class:"mb-8"},ue={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},ce=["onUpdate:modelValue"],me={class:"text-sm text-gray-600"},pe={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"},ye=["onUpdate:modelValue"],be={class:"text-sm text-gray-600"},fe=$({__name:"SubscriptionSettings",setup(p){const u=g([]),c=g([]),m=g(!0),o=g(null),v=async()=>{m.value=!0,o.value=null;try{const i=await q();u.value=i.policySources,c.value=i.competitorSources}catch(i){console.error("Error loading sources:",i),o.value=i instanceof Error?i.message:"获取信息源数据失败"}finally{m.value=!1}};return j(()=>{v()}),(i,r)=>(n(),d("div",ae,[r[3]||(r[3]=e("h3",{class:"text-lg font-semibold text-gray-800 mb-4 pb-4 border-b border-gray-200"},"信息源订阅",-1)),r[4]||(r[4]=e("p",{class:"text-sm text-gray-500 mb-6"},"勾选您希望接收更新和分析摘要的信息来源。",-1)),m.value?(n(),d("div",ne," 加载中... ")):b("",!0),!m.value&&o.value?(n(),d("div",le," 加载失败: "+x(o.value),1)):b("",!0),!m.value&&!o.value?(n(),d("div",de,[e("div",ie,[r[0]||(r[0]=e("h4",{class:"text-base font-medium text-gray-700 mb-3"},"监管政策来源",-1)),e("div",ue,[(n(!0),d(C,null,U(u.value,t=>(n(),d("label",{key:t.id,class:"flex items-center space-x-2 cursor-pointer"},[f(e("input",{type:"checkbox",class:"rounded text-primary border-gray-300 focus:ring-primary","onUpdate:modelValue":y=>t.checked=y},null,8,ce),[[w,t.checked]]),e("span",me,x(t.name),1)]))),128))])]),r[2]||(r[2]=e("hr",{class:"my-6 border-gray-200"},null,-1)),e("div",null,[r[1]||(r[1]=e("h4",{class:"text-base font-medium text-gray-700 mb-3"},"竞品信息来源",-1)),e("div",pe,[(n(!0),d(C,null,U(c.value,t=>(n(),d("label",{key:t.id,class:"flex items-center space-x-2 cursor-pointer"},[f(e("input",{type:"checkbox",class:"rounded text-primary border-gray-300 focus:ring-primary","onUpdate:modelValue":y=>t.checked=y},null,8,ye),[[w,t.checked]]),e("span",be,x(t.name),1)]))),128))])])])):b("",!0)]))}}),ge={class:"modal-content bg-white m-4 sm:m-10 p-6 rounded-lg shadow-xl w-full max-w-xl max-h-[90vh] overflow-y-auto"},xe={key:0,class:"modal-header flex justify-between items-center border-b border-gray-200 pb-4 mb-4"},ve={class:"modal-title text-lg font-semibold text-gray-800"},_e={class:"modal-body pb-4"},he={key:1,class:"modal-footer border-t border-gray-200 pt-4 flex justify-end gap-2"},ke=$({__name:"BaseModal",props:{isOpen:{type:Boolean,required:!0},title:{type:String,default:""},persistent:{type:Boolean,default:!1}},emits:["close"],setup(p,{emit:u}){const c=p,m=u,o=K(),v=Q(()=>!!o.footer),i=()=>{c.persistent||m("close")},r=t=>{t.key==="Escape"&&c.isOpen&&i()};return R(()=>c.isOpen,t=>{t?(document.addEventListener("keydown",r),document.body.style.overflow="hidden"):(document.removeEventListener("keydown",r),document.body.style.overflow="")}),W(()=>{document.removeEventListener("keydown",r),c.isOpen&&(document.body.style.overflow="")}),(t,y)=>(n(),X(Z,{to:"body"},[k(Y,{name:"modal-fade"},{default:N(()=>[p.isOpen?(n(),d("div",{key:0,class:"modal fixed inset-0 z-100 flex items-center justify-center overflow-auto bg-black bg-opacity-40",onClick:S(i,["self"])},[e("div",ge,[p.title?(n(),d("div",xe,[e("h4",ve,x(p.title),1),e("button",{class:"modal-close text-gray-500 hover:text-gray-700 text-2xl font-bold",onClick:i},"×")])):b("",!0),e("div",_e,[B(t.$slots,"default",{},void 0,!0)]),v.value?(n(),d("div",he,[B(t.$slots,"footer",{},void 0,!0)])):b("",!0)])])):b("",!0)]),_:3})]))}});const T=M(ke,[["__scopeId","data-v-ea5fab6d"]]),we={class:"bg-white rounded-lg shadow-sm p-6 mb-6"},$e={key:0,class:"text-center text-gray-500"},Pe={key:1,class:"text-center text-red-500"},Se={key:2},Me={class:"mb-4 space-y-2",id:"my-products-list"},Ee={key:0,class:"text-sm text-gray-500 text-center py-4"},Ve=["data-product-id"],Ce={class:"product-name text-sm font-medium text-gray-700"},Ue={class:"product-type-features text-xs text-gray-500"},Ne=["onClick"],Oe=["onClick"],je={class:"mb-4"},qe={class:"mb-4"},Be={class:"mb-4"},Te={class:"modal-footer mt-4"},Fe=["disabled"],De={key:0,class:"fas fa-spinner fa-spin mr-1"},Ie={class:"mb-4"},ze={class:"mb-4"},Ae={class:"mb-4"},Je={class:"modal-footer mt-4"},Le=["disabled"],Ge={key:0,class:"fas fa-spinner fa-spin mr-1"},He=$({__name:"ProductManagement",setup(p){const u=g([]),c=g(!0),m=g(null),o=g(!1),v=g(!1),i=O({name:"",type:"",features:""}),r=g(!1),t=O({id:"",name:"",type:"",features:""}),y=async()=>{c.value=!0,m.value=null;try{const l=await q();u.value=l.myProducts}catch(l){console.error("Error loading products:",l),m.value=l instanceof Error?l.message:"获取产品数据失败"}finally{c.value=!1}},F=()=>{Object.assign(i,{name:"",type:"",features:""}),v.value=!0},E=()=>{v.value=!1},D=async()=>{o.value=!0;try{const l=await te(i);l.success&&l.newProduct?(u.value.push(l.newProduct),alert(l.message),E()):alert(`添加失败: ${l.message}`)}catch(l){console.error("Error adding product:",l),alert("添加产品时发生错误")}finally{o.value=!1}},I=l=>{Object.assign(t,JSON.parse(JSON.stringify(l))),r.value=!0},V=()=>{r.value=!1},z=async()=>{o.value=!0;try{const l=await se(t);if(l.success){const s=u.value.findIndex(a=>a.id===t.id);s!==-1&&(u.value[s]={...t}),alert(l.message),V()}else alert(`更新失败: ${l.message}`)}catch(l){console.error("Error updating product:",l),alert("更新产品时发生错误")}finally{o.value=!1}},A=(l,s)=>{window.confirm("确定要删除这个产品吗？")&&J(l,s)},J=async(l,s)=>{try{const a=await oe(l);a.success?(u.value.splice(s,1),alert(a.message)):alert(`删除失败: ${a.message}`)}catch(a){console.error("Error deleting product:",a),alert("删除产品时发生错误")}};return j(()=>{y()}),(l,s)=>(n(),d("div",we,[s[14]||(s[14]=e("h3",{class:"text-lg font-semibold text-gray-800 mb-4 pb-4 border-b border-gray-200"},"我的产品管理",-1)),s[15]||(s[15]=e("p",{class:"text-sm text-gray-500 mb-4"},"添加您负责的产品信息，有助于系统提供更相关的分析建议。",-1)),c.value?(n(),d("div",$e," 加载中... ")):b("",!0),!c.value&&m.value?(n(),d("div",Pe," 加载失败: "+x(m.value),1)):b("",!0),!c.value&&!m.value?(n(),d("div",Se,[e("div",Me,[u.value.length===0?(n(),d("div",Ee,"暂无产品，请添加。")):b("",!0),(n(!0),d(C,null,U(u.value,(a,L)=>(n(),d("div",{key:a.id,class:"product-item flex items-center justify-between bg-gray-50 p-3 rounded-md","data-product-id":a.id},[e("div",null,[e("p",Ce,x(a.name),1),e("p",Ue," 类型："+x(a.type)+" | 特点："+x(a.features||"无"),1)]),e("div",null,[e("button",{onClick:G=>I(a),class:"edit-product-btn text-sm text-primary hover:underline mr-2"},"编辑",8,Ne),e("button",{onClick:G=>A(a.id,L),class:"delete-product-btn text-sm text-danger hover:underline"},"删除",8,Oe)])],8,Ve))),128))]),e("button",{onClick:F,class:"!rounded-button px-4 py-2 border border-gray-300 text-gray-600 hover:border-primary hover:text-primary text-sm"},s[7]||(s[7]=[e("i",{class:"fas fa-plus mr-1"},null,-1),_(" 添加我的产品 ")]))])):b("",!0),k(T,{"is-open":v.value,onClose:E,title:"添加我的产品"},{default:N(()=>[e("form",{onSubmit:S(D,["prevent"])},[e("div",je,[s[8]||(s[8]=e("label",{for:"addProductName",class:"block text-sm font-medium text-gray-700 mb-1"},[_("产品名称 "),e("span",{class:"text-red-500"},"*")],-1)),f(e("input",{type:"text",id:"addProductName","onUpdate:modelValue":s[0]||(s[0]=a=>i.name=a),required:"",class:"block w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm"},null,512),[[h,i.name]])]),e("div",qe,[s[9]||(s[9]=e("label",{for:"addProductType",class:"block text-sm font-medium text-gray-700 mb-1"},[_("产品类型 "),e("span",{class:"text-red-500"},"*")],-1)),f(e("input",{type:"text",id:"addProductType","onUpdate:modelValue":s[1]||(s[1]=a=>i.type=a),required:"",placeholder:"例如：信贷产品 或 信用卡",class:"block w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm"},null,512),[[h,i.type]])]),e("div",Be,[s[10]||(s[10]=e("label",{for:"addProductFeatures",class:"block text-sm font-medium text-gray-700 mb-1"},"产品特点/描述 (选填)",-1)),f(e("textarea",{id:"addProductFeatures","onUpdate:modelValue":s[2]||(s[2]=a=>i.features=a),rows:"3",placeholder:"例如：线上申请，快速审批 或 年轻客群，分期优惠",class:"block w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm resize-none"},null,512),[[h,i.features]])]),e("div",Te,[e("button",{type:"button",class:"!rounded-button px-4 py-2 border border-gray-300 text-gray-600 hover:bg-gray-50 text-sm",onClick:E},"取消"),e("button",{type:"submit",class:"!rounded-button px-4 py-2 bg-primary text-white hover:bg-primary/90 text-sm",disabled:o.value},[o.value?(n(),d("i",De)):b("",!0),_(" "+x(o.value?"添加中...":"确认添加"),1)],8,Fe)])],32)]),_:1},8,["is-open"]),k(T,{"is-open":r.value,onClose:V,title:"编辑我的产品"},{default:N(()=>[e("form",{onSubmit:S(z,["prevent"])},[f(e("input",{type:"hidden","onUpdate:modelValue":s[3]||(s[3]=a=>t.id=a)},null,512),[[h,t.id]]),e("div",Ie,[s[11]||(s[11]=e("label",{for:"editProductName",class:"block text-sm font-medium text-gray-700 mb-1"},[_("产品名称 "),e("span",{class:"text-red-500"},"*")],-1)),f(e("input",{type:"text",id:"editProductName","onUpdate:modelValue":s[4]||(s[4]=a=>t.name=a),required:"",class:"block w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm"},null,512),[[h,t.name]])]),e("div",ze,[s[12]||(s[12]=e("label",{for:"editProductType",class:"block text-sm font-medium text-gray-700 mb-1"},[_("产品类型 "),e("span",{class:"text-red-500"},"*")],-1)),f(e("input",{type:"text",id:"editProductType","onUpdate:modelValue":s[5]||(s[5]=a=>t.type=a),required:"",placeholder:"例如：信贷产品 或 信用卡",class:"block w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm"},null,512),[[h,t.type]])]),e("div",Ae,[s[13]||(s[13]=e("label",{for:"editProductFeatures",class:"block text-sm font-medium text-gray-700 mb-1"},"产品特点/描述 (选填)",-1)),f(e("textarea",{id:"editProductFeatures","onUpdate:modelValue":s[6]||(s[6]=a=>t.features=a),rows:"3",placeholder:"例如：线上申请，快速审批 或 年轻客群，分期优惠",class:"block w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm resize-none"},null,512),[[h,t.features]])]),e("div",Je,[e("button",{type:"button",class:"!rounded-button px-4 py-2 border border-gray-300 text-gray-600 hover:bg-gray-50 text-sm",onClick:V},"取消"),e("button",{type:"submit",class:"!rounded-button px-4 py-2 bg-primary text-white hover:bg-primary/90 text-sm",disabled:o.value},[o.value?(n(),d("i",Ge)):b("",!0),_(" "+x(o.value?"保存中...":"保存修改"),1)],8,Le)])],32)]),_:1},8,["is-open"])]))}});const Ke=M(He,[["__scopeId","data-v-3f6a7710"]]),Qe={class:"bg-white rounded-lg shadow-sm p-6"},Re={key:0,class:"text-center text-gray-500"},We={key:1,class:"text-center text-red-500"},Xe={class:"mb-6"},Ye={class:"space-y-2"},Ze={class:"flex items-center space-x-2 cursor-pointer"},et={class:"flex items-center space-x-2 cursor-pointer"},tt={class:"flex items-center space-x-2 cursor-pointer"},st={class:"flex items-center space-x-2 cursor-pointer"},ot={class:"mt-8 pt-6 border-t border-gray-200 flex justify-end"},rt=["disabled"],at={key:0,class:"fas fa-spinner fa-spin mr-1"},nt=$({__name:"PushNotifications",setup(p){const u=g(!0),c=g(null),m=g(!1),o=O({frequency:"每日精选摘要",channels:[]}),v=async()=>{u.value=!0,c.value=null;try{const r=await q();Object.assign(o,r.pushSettings)}catch(r){console.error("Error loading push settings:",r),c.value=r instanceof Error?r.message:"获取推送设置失败"}finally{u.value=!1}},i=async()=>{m.value=!0;try{const r=JSON.parse(JSON.stringify(o)),t=await re(r);t.success?alert(t.message):alert(`保存失败: ${t.message}`)}catch(r){console.error("Error saving push settings:",r),alert("保存推送设置时发生错误")}finally{m.value=!1}};return j(()=>{v()}),(r,t)=>(n(),d("div",Qe,[t[13]||(t[13]=e("h3",{class:"text-lg font-semibold text-gray-800 mb-4 pb-4 border-b border-gray-200"},"推送设置",-1)),u.value?(n(),d("div",Re," 加载中... ")):b("",!0),!u.value&&c.value?(n(),d("div",We," 加载失败: "+x(c.value),1)):b("",!0),!u.value&&!c.value?(n(),d("form",{key:2,onSubmit:S(i,["prevent"])},[e("div",Xe,[t[6]||(t[6]=e("label",{for:"notification-frequency",class:"block text-base font-medium text-gray-700 mb-2"},"接收频率",-1)),f(e("select",{id:"notification-frequency","onUpdate:modelValue":t[0]||(t[0]=y=>o.frequency=y),class:"block w-full sm:w-60 px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm"},t[5]||(t[5]=[e("option",{value:"每日精选摘要"},"每日精选摘要",-1),e("option",{value:"每周重点回顾"},"每周重点回顾",-1),e("option",{value:"关闭推送"},"关闭推送",-1)]),512),[[ee,o.frequency]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-base font-medium text-gray-700 mb-2"},"紧急预警通知方式",-1)),t[12]||(t[12]=e("p",{class:"text-sm text-gray-500 mb-3"},"选择接收重大政策或竞品动态紧急预警的渠道（可多选）：",-1)),e("div",Ye,[e("label",Ze,[f(e("input",{type:"checkbox",class:"rounded text-primary border-gray-300 focus:ring-primary",value:"wechat","onUpdate:modelValue":t[1]||(t[1]=y=>o.channels=y)},null,512),[[w,o.channels]]),t[7]||(t[7]=e("span",{class:"text-sm text-gray-600"},"微信推送",-1))]),e("label",et,[f(e("input",{type:"checkbox",class:"rounded text-primary border-gray-300 focus:ring-primary",value:"sms","onUpdate:modelValue":t[2]||(t[2]=y=>o.channels=y)},null,512),[[w,o.channels]]),t[8]||(t[8]=e("span",{class:"text-sm text-gray-600"},"短信通知",-1))]),e("label",tt,[f(e("input",{type:"checkbox",class:"rounded text-primary border-gray-300 focus:ring-primary",value:"email","onUpdate:modelValue":t[3]||(t[3]=y=>o.channels=y)},null,512),[[w,o.channels]]),t[9]||(t[9]=e("span",{class:"text-sm text-gray-600"},"邮件提醒",-1))]),e("label",st,[f(e("input",{type:"checkbox",class:"rounded text-primary border-gray-300 focus:ring-primary",value:"site","onUpdate:modelValue":t[4]||(t[4]=y=>o.channels=y)},null,512),[[w,o.channels]]),t[10]||(t[10]=e("span",{class:"text-sm text-gray-600"},"站内信",-1))])])]),e("div",ot,[e("button",{type:"submit",class:"!rounded-button px-6 py-2 bg-primary text-white hover:bg-primary/90 text-sm",disabled:m.value},[m.value?(n(),d("i",at)):b("",!0),_(" "+x(m.value?"保存中...":"保存设置"),1)],8,rt)])],32)):b("",!0)]))}});const lt=M(nt,[["__scopeId","data-v-5f8af9dd"]]),dt={class:"max-w-[1440px] mx-auto px-6 pt-24 pb-12"},it="/settings",ut=$({__name:"SettingsPage",setup(p){const u=g({name:"戴维",avatar:"https://randomuser.me/api/portraits/men/32.jpg",notifications:2});return(c,m)=>(n(),d("div",null,[k(H,{"active-menu":it,user:u.value},null,8,["user"]),e("div",dt,[k(fe),k(Ke),k(lt)])]))}});const yt=M(ut,[["__scopeId","data-v-f22615a5"]]);export{yt as default};

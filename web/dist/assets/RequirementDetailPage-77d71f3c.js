import{d as E,m as g,j as q,c as o,e as d,a as t,w as p,t as l,b as n,F as x,f,g as y,l as C,A as R,y as I,E as c,B as N,r as B,o as a,n as M}from"./index-095c05da.js";import{N as $,_ as P}from"./axios-c1489369.js";import{d as O,_ as L}from"./defaultData-fb71e1fd.js";import{_ as S,a as A}from"./PriorityTag.vue_vue_type_script_setup_true_lang-183a5e05.js";import{g as V,d as j}from"./requirementService-f5232c39.js";import"./axiosInstance-4195a5ae.js";const F={class:"max-w-[1200px] mx-auto px-6 pt-24 pb-12"},Y={key:0,class:"flex justify-center items-center py-20"},U={key:1,class:"bg-white rounded-lg shadow-sm p-8"},z={class:"text-center py-10"},J={key:2,class:"bg-white rounded-lg shadow-sm p-8"},G={class:"mb-6 pb-4 border-b border-gray-200"},H={class:"text-2xl font-semibold text-gray-800 mb-3"},K={class:"grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 mb-8 text-sm"},Q={class:"detail-item"},W={class:"detail-item"},X={class:"detail-item"},Z={key:2},ee={class:"detail-item"},te={class:"detail-item"},se={class:"detail-item"},re={class:"detail-item"},ae={key:0,class:"mb-8"},le={class:"prose prose-sm max-w-none text-gray-600 leading-relaxed border border-gray-200 rounded-md p-4 bg-gray-50 whitespace-pre-line"},oe={class:"mb-8"},ne={class:"prose prose-sm max-w-none text-gray-600 leading-relaxed border border-gray-200 rounded-md p-4 bg-gray-50 whitespace-pre-line"},ie={key:1,class:"mb-6"},de={class:"border border-gray-200 rounded-md p-4 text-sm"},ue={class:"list-disc list-inside space-y-1 text-gray-700"},me=["href"],pe={class:"flex justify-end space-x-3 mt-8 pt-4 border-t border-gray-200"},ce=E({__name:"RequirementDetailPage",setup(ye){const b=R(),_=I(),h=g(O),s=g(null),m=g(!0),w=async()=>{m.value=!0;try{const r=Number(b.params.id);if(isNaN(r))throw new Error("无效的需求ID");const e=await V(r);e.code===200&&e.data?s.value=e.data:(c.error(e.message||"获取需求详情失败"),s.value=null)}catch(r){c.error(r.message||"获取需求详情失败"),s.value=null}finally{m.value=!1}},v=r=>{if(!r)return"-";try{const e=new Date(r),i=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),T=String(e.getDate()).padStart(2,"0");return`${i}-${u}-${T}`}catch(e){return console.error("Error formatting date:",e),"-"}},k=r=>r==="POLICY"?"监管政策":r==="COMPETITOR"?"竞品动态":r==="MANUAL"?"手动创建":"未知来源",D=async()=>{if(s.value)try{await N.confirm("确定要删除此需求吗？此操作不可恢复。","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),m.value=!0;const r=await j(s.value.id);r.code===200?(c.success("删除成功"),_.push("/requirement-pool")):c.error(r.message||"删除失败")}catch(r){r!=="cancel"&&c.error(r.message||"删除操作失败")}finally{m.value=!1}};return q(()=>{w()}),(r,e)=>{const i=B("router-link");return a(),o("div",null,[d($,{activeMenu:"/requirement-pool",user:h.value},null,8,["user"]),t("main",F,[m.value?(a(),o("div",Y,e[0]||(e[0]=[t("i",{class:"fas fa-spinner fa-spin text-2xl text-primary mr-2"},null,-1),t("span",null,"加载中...",-1)]))):s.value?(a(),o("div",J,[t("div",G,[t("h2",H,l(s.value.title),1)]),t("div",K,[t("dl",Q,[e[3]||(e[3]=t("dt",null,"状态",-1)),t("dd",null,[d(S,{status:s.value.statusType,text:s.value.statusText},null,8,["status","text"])])]),t("dl",W,[e[4]||(e[4]=t("dt",null,"优先级",-1)),t("dd",null,[d(A,{priority:s.value.priorityLevel,text:s.value.priority},null,8,["priority","text"])])]),t("dl",X,[e[6]||(e[6]=t("dt",null,"来源",-1)),t("dd",null,[n(l(k(s.value.sourceType))+" ",1),s.value.sourceDetail?(a(),o(x,{key:0},[e[5]||(e[5]=n(" ： ")),s.value.sourceType==="POLICY"&&s.value.sourceId?(a(),f(i,{key:0,to:`/policy-detail/${s.value.sourceId}`,class:"text-primary hover:underline"},{default:p(()=>[n(l(s.value.sourceDetail),1)]),_:1},8,["to"])):s.value.sourceType==="COMPETITOR"&&s.value.sourceId?(a(),f(i,{key:1,to:`/competitor-detail/${s.value.sourceId}`,class:"text-primary hover:underline"},{default:p(()=>[n(l(s.value.sourceDetail),1)]),_:1},8,["to"])):(a(),o("span",Z,l(s.value.sourceDetail),1))],64)):y("",!0)])]),t("dl",ee,[e[7]||(e[7]=t("dt",null,"创建日期",-1)),t("dd",null,l(v(s.value.createTime)),1)]),t("dl",te,[e[8]||(e[8]=t("dt",null,"计划完成",-1)),t("dd",null,l(v(s.value.planTime)),1)]),t("dl",se,[e[9]||(e[9]=t("dt",null,"负责人",-1)),t("dd",null,l(s.value.owner||"未分配"),1)]),t("dl",re,[e[10]||(e[10]=t("dt",null,"完成时间",-1)),t("dd",null,l(v(s.value.completeTime)),1)])]),s.value.background?(a(),o("div",ae,[e[11]||(e[11]=t("h4",{class:"text-base font-semibold text-gray-700 mb-3"},"需求背景：",-1)),t("div",le,l(s.value.background),1)])):y("",!0),t("div",oe,[e[12]||(e[12]=t("h4",{class:"text-base font-semibold text-gray-700 mb-3"},"详细描述：",-1)),t("div",ne,l(s.value.description),1)]),s.value.attachments&&s.value.attachments.length>0?(a(),o("div",ie,[e[14]||(e[14]=t("h4",{class:"text-base font-semibold text-gray-700 mb-3"},"关联信息/附件：",-1)),t("div",de,[t("ul",ue,[(a(!0),o(x,null,C(s.value.attachments,u=>(a(),o("li",{key:u.id},[t("a",{href:u.url,target:"_blank",class:"text-primary hover:underline"},[t("i",{class:M("fas fa-"+u.type+" mr-1")},null,2),n(" "+l(u.name),1)],8,me)]))),128))]),e[13]||(e[13]=t("button",{class:"!rounded-button mt-3 px-3 py-1 border border-gray-300 text-gray-600 hover:border-primary hover:text-primary text-xs whitespace-nowrap"},[t("i",{class:"fas fa-paperclip mr-1"}),n(" 上传附件 (未实现) ")],-1))])])):y("",!0),t("div",pe,[d(i,{to:"/requirement-pool",class:"!rounded-button px-4 py-2 border border-gray-300 text-gray-600 hover:border-primary hover:text-primary text-sm whitespace-nowrap"},{default:p(()=>e[15]||(e[15]=[t("i",{class:"fas fa-arrow-left mr-1"},null,-1),n(" 返回列表 ")])),_:1}),d(i,{to:`/requirement-edit/${s.value.id}`,class:"!rounded-button px-4 py-2 bg-primary text-white text-sm whitespace-nowrap hover:bg-primary/90"},{default:p(()=>e[16]||(e[16]=[t("i",{class:"fas fa-edit mr-1"},null,-1),n(" 编辑需求 ")])),_:1},8,["to"]),s.value.status!=="REJECTED"&&s.value.status!=="COMPLETED"?(a(),o("button",{key:0,class:"!rounded-button px-4 py-2 border border-danger text-danger hover:bg-danger/10 text-sm whitespace-nowrap",onClick:D},e[17]||(e[17]=[t("i",{class:"fas fa-trash mr-1"},null,-1),n(" 删除需求 ")]))):y("",!0)])])):(a(),o("div",U,[t("div",z,[e[2]||(e[2]=t("p",{class:"text-lg text-gray-600"},"未找到需求信息",-1)),d(i,{to:"/requirement-pool",class:"text-primary hover:underline mt-4 inline-block"},{default:p(()=>e[1]||(e[1]=[n(" 返回需求池 ")])),_:1})])]))]),d(L,{copyright:"© 2024 金融资讯智能跟踪平台. All rights reserved."})])}}});const he=P(ce,[["__scopeId","data-v-9faa613a"]]);export{he as default};

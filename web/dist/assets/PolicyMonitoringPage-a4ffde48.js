import{_ as I,N as T}from"./axios-c1489369.js";import{p as j,b as q,c as B,_ as E,d as L}from"./defaultData-fb71e1fd.js";import{d as w,s as S,o as i,c as n,a as e,p as k,x as O,v as M,F as x,l as h,t as g,u as $,b as V,y as U,k as _,r as z,n as C,g as F,e as v,w as R,E as D,f as A,z as N,m as P,j as K}from"./index-095c05da.js";import{c as G}from"./requirementService-f5232c39.js";import{g as H}from"./policy-665470be.js";import"./axiosInstance-4195a5ae.js";import"./request-211124dc.js";const J={class:"bg-white rounded-lg shadow-sm p-6 mb-6"},Q={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 items-end"},W={class:"col-span-1 md:col-span-3 lg:col-span-2"},X=["value"],Y=["value"],Z=["value"],ee=w({__name:"PolicyFilter",props:{initialFilter:{}},emits:["filter"],setup(b,{emit:f}){var s,t,a,p;const l=b,m=f,r=S({keyword:((s=l.initialFilter)==null?void 0:s.keyword)||"",source:((t=l.initialFilter)==null?void 0:t.source)||"",category:((a=l.initialFilter)==null?void 0:a.category)||"",importance:((p=l.initialFilter)==null?void 0:p.importance)||""}),d=()=>{r.keyword="",r.source="",r.category="",r.importance="",m("filter",{...r})},y=()=>{m("filter",{...r})};return(u,o)=>(i(),n("div",J,[e("div",Q,[e("div",W,[o[4]||(o[4]=e("label",{for:"searchKeyword",class:"block text-sm font-medium text-gray-700 mb-1"},"关键词搜索",-1)),k(e("input",{type:"text",id:"searchKeyword","onUpdate:modelValue":o[0]||(o[0]=c=>r.keyword=c),placeholder:"输入政策标题、文号或关键词",class:"w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm"},null,512),[[O,r.keyword]])]),e("div",null,[o[5]||(o[5]=e("label",{for:"policySource",class:"block text-sm font-medium text-gray-700 mb-1"},"政策来源",-1)),k(e("select",{id:"policySource","onUpdate:modelValue":o[1]||(o[1]=c=>r.source=c),class:"w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm bg-white"},[(i(!0),n(x,null,h($(j),c=>(i(),n("option",{key:c.value,value:c.value},g(c.label),9,X))),128))],512),[[M,r.source]])]),e("div",null,[o[6]||(o[6]=e("label",{for:"policyCategory",class:"block text-sm font-medium text-gray-700 mb-1"},"政策分类",-1)),k(e("select",{id:"policyCategory","onUpdate:modelValue":o[2]||(o[2]=c=>r.category=c),class:"w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm bg-white"},[(i(!0),n(x,null,h($(q),c=>(i(),n("option",{key:c.value,value:c.value},g(c.label),9,Y))),128))],512),[[M,r.category]])]),e("div",null,[o[7]||(o[7]=e("label",{for:"policyImportance",class:"block text-sm font-medium text-gray-700 mb-1"},"重要性",-1)),k(e("select",{id:"policyImportance","onUpdate:modelValue":o[3]||(o[3]=c=>r.importance=c),class:"w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm bg-white"},[(i(!0),n(x,null,h($(B),c=>(i(),n("option",{key:c.value,value:c.value},g(c.label),9,Z))),128))],512),[[M,r.importance]])]),o[10]||(o[10]=e("div",{class:"hidden lg:block"},null,-1)),o[11]||(o[11]=e("div",{class:"hidden lg:block"},null,-1)),o[12]||(o[12]=e("div",{class:"hidden lg:block"},null,-1)),e("div",{class:"flex space-x-3 col-span-1 lg:col-span-2 justify-end"},[e("button",{class:"!rounded-button px-4 py-2 border border-gray-300 text-gray-600 hover:border-primary hover:text-primary text-sm whitespace-nowrap",onClick:d},o[8]||(o[8]=[e("i",{class:"fas fa-undo mr-1"},null,-1),V(" 重置 ")])),e("button",{class:"!rounded-button px-4 py-2 bg-primary text-white hover:bg-primary/90 text-sm whitespace-nowrap",onClick:y},o[9]||(o[9]=[e("i",{class:"fas fa-search mr-1"},null,-1),V(" 查询 ")]))])])]))}});const te=I(ee,[["__scopeId","data-v-a7165386"]]),re={class:"bg-white rounded-lg shadow-sm p-6 card-hover flex flex-col"},oe={class:"flex items-center text-xs text-gray-500 mb-3"},se={class:"flex flex-wrap gap-2 mb-3"},ae={key:1,class:"px-2 py-0.5 text-xs font-medium rounded-full bg-purple-100 text-purple-600"},le={class:"text-sm text-gray-600 mb-4 flex-grow"},ie={class:"flex justify-end space-x-3 mt-auto pt-4 border-t border-gray-100"},ne=w({__name:"PolicyCard",props:{policy:{}},setup(b){const f=U(),l=b,m=_(()=>{const t=l.policy.publishTime;if(!t)return"未知";try{return new Date(t).toLocaleDateString()}catch(a){return console.error("Error formatting date:",a),t}}),r=_(()=>{const t={高:"高",中:"中",低:"低"};return l.policy.importance?t[l.policy.importance]||l.policy.importance:""}),d=_(()=>l.policy.importance?{高:"bg-red-100 text-red-600",中:"bg-yellow-100 text-yellow-600",低:"bg-green-100 text-green-600"}[l.policy.importance]||"bg-gray-100 text-gray-600":""),y=()=>{f.push({name:"PolicyDetail",params:{id:l.policy.id}})},s=async()=>{var t,a;if(!l.policy.id){D.error("无法获取政策ID");return}try{await G(l.policy.id),D.success("需求已成功转化！")}catch(p){console.error("Error converting policy to requirement:",p),D.error(((a=(t=p.response)==null?void 0:t.data)==null?void 0:a.message)||"需求转化失败，请稍后重试")}};return(t,a)=>{const p=z("router-link");return i(),n("div",re,[e("h4",{class:"text-base font-semibold text-gray-800 mb-2 hover:text-primary cursor-pointer",onClick:y},g(t.policy.title),1),e("div",oe,[e("span",null,"来源："+g(t.policy.source||"未知"),1),a[0]||(a[0]=e("span",{class:"mx-2"},"|",-1)),e("span",null,"发布日期："+g(m.value),1)]),e("div",se,[r.value?(i(),n("span",{key:0,class:C(["px-2 py-0.5 text-xs font-medium rounded-full",d.value])},g(r.value),3)):F("",!0),t.policy.policyType?(i(),n("span",ae,g(t.policy.policyType),1)):F("",!0),t.policy.areas&&t.policy.areas.length?(i(!0),n(x,{key:2},h(t.policy.areas,(u,o)=>(i(),n("span",{key:`area-${o}`,class:"px-2 py-0.5 text-xs font-medium rounded-full bg-blue-100 text-blue-600"},g(u),1))),128)):F("",!0)]),e("p",le,g(t.policy.suggestion||t.policy.summary||"暂无建议"),1),e("div",ie,[v(p,{to:{name:"PolicyDetail",params:{id:t.policy.id}},class:"!rounded-button text-sm text-primary hover:underline whitespace-nowrap cursor-pointer"},{default:R(()=>a[1]||(a[1]=[V(" 查看详情 ")])),_:1},8,["to"]),e("button",{class:"!rounded-button px-3 py-1 bg-primary text-white text-sm whitespace-nowrap hover:bg-primary/90",onClick:s}," 转为需求 ")])])}}});const ce=I(ne,[["__scopeId","data-v-b182a705"]]),ue={key:0,class:"col-span-1 lg:col-span-2 text-center py-12"},pe={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},de={key:0,class:"col-span-1 lg:col-span-2 text-center py-12"},ye=w({__name:"PolicyList",props:{policies:{type:Array,required:!0},filters:{type:Object,required:!0},loading:{type:Boolean,default:!1}},setup(b){const f=b,l=_(()=>f.policies);return(m,r)=>(i(),n("div",null,[b.loading?(i(),n("div",ue,r[0]||(r[0]=[e("i",{class:"fas fa-spinner fa-spin text-gray-300 text-4xl mb-4"},null,-1),e("p",{class:"text-gray-500"},"加载中...",-1)]))):(i(),n("div",pe,[(i(!0),n(x,null,h(l.value,d=>(i(),A(ce,{key:d.id,policy:d},null,8,["policy"]))),128)),l.value.length===0?(i(),n("div",de,r[1]||(r[1]=[e("i",{class:"fas fa-search text-gray-300 text-4xl mb-4"},null,-1),e("p",{class:"text-gray-500"},"暂无符合条件的政策",-1)]))):F("",!0)]))]))}}),ge={class:"mt-8 flex justify-center"},me={"aria-label":"Page navigation"},be={class:"inline-flex items-center -space-x-px"},fe=["onClick"],ve={key:1,class:"py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300"},xe=w({__name:"PolicyPagination",props:{currentPage:{},totalItems:{},itemsPerPage:{}},emits:["page-change"],setup(b,{emit:f}){const l=b,m=f,r=_(()=>Math.ceil(l.totalItems/l.itemsPerPage)),d=_(()=>{const s=[];if(r.value<=5)for(let a=1;a<=r.value;a++)s.push(a);else{s.push(1);let a=Math.max(2,l.currentPage-1),p=Math.min(r.value-1,l.currentPage+1);l.currentPage<=3&&(p=4),l.currentPage>=r.value-2&&(a=r.value-3),a>2&&s.push("...");for(let u=a;u<=p;u++)s.push(u);p<r.value-1&&s.push("..."),s.push(r.value)}return s}),y=s=>{s<1||s>r.value||m("page-change",s)};return(s,t)=>(i(),n("div",ge,[e("nav",me,[e("ul",be,[e("li",null,[e("a",{href:"#",class:C(["py-2 px-3 ml-0 leading-tight text-gray-500 bg-white rounded-l-button border border-gray-300 hover:bg-gray-100 hover:text-gray-700 cursor-pointer",{"opacity-50 cursor-not-allowed":s.currentPage===1}]),onClick:t[0]||(t[0]=N(a=>y(s.currentPage-1),["prevent"]))},t[2]||(t[2]=[e("span",{class:"sr-only"},"Previous",-1),e("i",{class:"fas fa-chevron-left text-xs"},null,-1)]),2)]),(i(!0),n(x,null,h(d.value,a=>(i(),n("li",{key:a},[a!=="..."?(i(),n("a",{key:0,href:"#",class:C(["py-2 px-3 leading-tight border border-gray-300 cursor-pointer",s.currentPage===Number(a)?"text-primary bg-blue-50 hover:bg-blue-100 hover:text-primary z-10":"text-gray-500 bg-white hover:bg-gray-100 hover:text-gray-700"]),onClick:N(p=>y(Number(a)),["prevent"])},g(a),11,fe)):(i(),n("span",ve," ... "))]))),128)),e("li",null,[e("a",{href:"#",class:C(["py-2 px-3 leading-tight text-gray-500 bg-white rounded-r-button border border-gray-300 hover:bg-gray-100 hover:text-gray-700 cursor-pointer",{"opacity-50 cursor-not-allowed":s.currentPage===r.value}]),onClick:t[1]||(t[1]=N(a=>y(s.currentPage+1),["prevent"]))},t[3]||(t[3]=[e("span",{class:"sr-only"},"Next",-1),e("i",{class:"fas fa-chevron-right text-xs"},null,-1)]),2)])])])]))}}),he={class:"max-w-[1440px] mx-auto px-6 pt-24 pb-12"},_e=w({__name:"PolicyMonitoringPage",setup(b){const f=L,l=P(1),m=P(6),r=P(0),d=P(!1),y=P([]),s=S({keyword:"",source:"",category:"",importance:""}),t=async()=>{d.value=!0;try{const u={pageNum:l.value,pageSize:m.value};if(s.keyword&&(u.title=s.keyword),s.source&&(u.source=s.source),s.importance){const c={高:3,中:2,低:1};u.importance=c[s.importance]}const o=await H(u);o&&typeof o=="object"&&(y.value=o.list||[],r.value=o.total||0)}catch(u){console.error("获取政策列表失败:",u),y.value=[],r.value=0}finally{d.value=!1}},a=u=>{Object.assign(s,u),l.value=1,t()},p=u=>{l.value=u,t()};return K(()=>{t()}),(u,o)=>(i(),n("div",null,[v(T,{"active-menu":"/policy-monitoring",user:$(f)},null,8,["user"]),e("main",he,[v(te,{"initial-filter":s,onFilter:a},null,8,["initial-filter"]),v(ye,{policies:y.value,filters:s,loading:d.value},null,8,["policies","filters","loading"]),v(xe,{"current-page":l.value,"total-items":r.value,"items-per-page":m.value,onPageChange:p},null,8,["current-page","total-items","items-per-page"])]),v(E,{copyright:"© 2024 金融资讯智能跟踪平台. All rights reserved."})]))}});const De=I(_e,[["__scopeId","data-v-b60b1731"]]);export{De as default};

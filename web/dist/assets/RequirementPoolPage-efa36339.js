import{d as D,m as p,r as B,o as i,c as u,a as e,p as k,x as I,v as R,F as q,l as $,t as x,u as T,e as v,w as O,b as S,k as U,i as V,j,y as z,E as w,B as A}from"./index-095c05da.js";import{_ as P,N as K}from"./axios-c1489369.js";import{r as L,h as Y,i as G,d as H,_ as J}from"./defaultData-fb71e1fd.js";import{_ as Q,a as W}from"./PriorityTag.vue_vue_type_script_setup_true_lang-183a5e05.js";import{l as X,d as Z}from"./requirementService-f5232c39.js";import"./axiosInstance-4195a5ae.js";const ee={class:"bg-white rounded-lg shadow-sm p-6 mb-6"},te={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 items-end"},se={class:"col-span-1 md:col-span-3 lg:col-span-2"},re=["value"],ae=["value"],oe=["value"],le={class:"col-span-full mt-4 flex justify-between items-center"},ne=D({__name:"RequirementFilter",emits:["search","reset"],setup(f,{emit:h}){const m=h,o=p({keyword:"",status:"",priority:"",source:""}),n=()=>{m("search",{...o.value})},y=()=>{o.value={keyword:"",status:"",priority:"",source:""},m("reset")};return(c,r)=>{const _=B("router-link");return i(),u("div",ee,[e("div",te,[e("div",se,[r[4]||(r[4]=e("label",{for:"searchKeyword",class:"block text-sm font-medium text-gray-700 mb-1"},"关键词",-1)),k(e("input",{type:"text",id:"searchKeyword","onUpdate:modelValue":r[0]||(r[0]=s=>o.value.keyword=s),placeholder:"搜索需求标题或描述",class:"w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm"},null,512),[[I,o.value.keyword]])]),e("div",null,[r[5]||(r[5]=e("label",{for:"reqStatus",class:"block text-sm font-medium text-gray-700 mb-1"},"状态",-1)),k(e("select",{id:"reqStatus","onUpdate:modelValue":r[1]||(r[1]=s=>o.value.status=s),class:"w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm bg-white"},[(i(!0),u(q,null,$(T(L),s=>(i(),u("option",{key:s.value,value:s.value},x(s.label),9,re))),128))],512),[[R,o.value.status]])]),e("div",null,[r[6]||(r[6]=e("label",{for:"reqPriority",class:"block text-sm font-medium text-gray-700 mb-1"},"优先级",-1)),k(e("select",{id:"reqPriority","onUpdate:modelValue":r[2]||(r[2]=s=>o.value.priority=s),class:"w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm bg-white"},[(i(!0),u(q,null,$(T(Y),s=>(i(),u("option",{key:s.value,value:s.value},x(s.label),9,ae))),128))],512),[[R,o.value.priority]])]),e("div",null,[r[7]||(r[7]=e("label",{for:"reqSource",class:"block text-sm font-medium text-gray-700 mb-1"},"来源",-1)),k(e("select",{id:"reqSource","onUpdate:modelValue":r[3]||(r[3]=s=>o.value.source=s),class:"w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm bg-white"},[(i(!0),u(q,null,$(T(G),s=>(i(),u("option",{key:s.value,value:s.value},x(s.label),9,oe))),128))],512),[[R,o.value.source]])]),e("div",le,[v(_,{to:"/requirement-add",class:"!rounded-button px-4 py-2 bg-primary text-white hover:bg-primary/90 text-sm whitespace-nowrap"},{default:O(()=>r[8]||(r[8]=[e("i",{class:"fas fa-plus mr-1"},null,-1),S(" 新增需求 ")])),_:1}),e("div",{class:"flex space-x-3"},[e("button",{onClick:y,class:"!rounded-button px-4 py-2 border border-gray-300 text-gray-600 hover:border-primary hover:text-primary text-sm whitespace-nowrap"},r[9]||(r[9]=[e("i",{class:"fas fa-undo mr-1"},null,-1),S(" 重置 ")])),e("button",{onClick:n,class:"!rounded-button px-4 py-2 bg-primary text-white hover:bg-primary/90 text-sm whitespace-nowrap"},r[10]||(r[10]=[e("i",{class:"fas fa-search mr-1"},null,-1),S(" 查询 ")]))])])])])}}});const ie=P(ne,[["__scopeId","data-v-748f033d"]]),ue={class:"bg-white rounded-lg shadow-sm"},de={class:"w-full table-fixed"},ce={class:"bg-gray-50 border-b border-gray-200"},pe={class:"p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10"},me=["checked"],ye={class:"divide-y divide-gray-200"},ge={key:0},xe={key:1},ve={class:"p-3 whitespace-nowrap"},fe=["checked","onChange"],he={class:"p-3 text-sm text-gray-700 font-medium truncate"},_e=["onClick","title"],we={class:"p-3 whitespace-nowrap"},be={class:"p-3 whitespace-nowrap"},ke={class:"p-3 text-sm text-gray-500 hidden md:table-cell truncate md:w-32"},qe=["title"],$e={class:"p-3 text-sm text-gray-500 hidden md:table-cell md:w-28 whitespace-nowrap"},Se={class:"p-3 text-sm text-gray-500 hidden md:table-cell md:w-28 whitespace-nowrap"},Ce={class:"p-3 whitespace-nowrap"},Re={class:"flex space-x-1"},Te=["onClick"],De=["onClick"],Pe=["onClick"],Be=D({__name:"RequirementTable",props:{requirements:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["view","edit","delete","select"],setup(f,{emit:h}){const m=f,o=h,n=p([]),y=U(()=>m.requirements.length>0&&n.value.length===m.requirements.length),c=()=>{y.value?n.value=[]:n.value=m.requirements.map(s=>s.id),o("select",n.value)},r=s=>{const t=n.value.indexOf(s);t===-1?n.value.push(s):n.value.splice(t,1),o("select",n.value)},_=s=>{if(!s)return"-";try{const t=new Date(s),a=t.getFullYear(),g=String(t.getMonth()+1).padStart(2,"0"),C=String(t.getDate()).padStart(2,"0");return`${a}-${g}-${C}`}catch(t){return console.error("Error formatting date:",t),"-"}};return V(()=>m.requirements,()=>{n.value=[]},{deep:!0}),(s,t)=>(i(),u("div",ue,[e("table",de,[e("thead",null,[e("tr",ce,[e("th",pe,[e("input",{type:"checkbox",class:"rounded text-primary focus:ring-primary border-gray-300",checked:y.value,onChange:c},null,40,me)]),t[0]||(t[0]=e("th",{class:"p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"需求标题",-1)),t[1]||(t[1]=e("th",{class:"p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20 md:w-24"},"状态",-1)),t[2]||(t[2]=e("th",{class:"p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-16 md:w-20"},"优先级",-1)),t[3]||(t[3]=e("th",{class:"p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell md:w-32"},"来源",-1)),t[4]||(t[4]=e("th",{class:"p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell md:w-28 whitespace-nowrap"},"创建日期",-1)),t[5]||(t[5]=e("th",{class:"p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell md:w-28 whitespace-nowrap"},"计划完成",-1)),t[6]||(t[6]=e("th",{class:"p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24"},"操作",-1))])]),e("tbody",ye,[f.loading?(i(),u("tr",ge,t[7]||(t[7]=[e("td",{colspan:"8",class:"p-6 text-center text-gray-500"},[e("i",{class:"fas fa-spinner fa-spin mr-2"}),S(" 加载中... ")],-1)]))):f.requirements.length===0?(i(),u("tr",xe,t[8]||(t[8]=[e("td",{colspan:"8",class:"p-6 text-center text-gray-500"}," 暂无匹配的需求记录 ",-1)]))):(i(!0),u(q,{key:2},$(f.requirements,a=>(i(),u("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",ve,[e("input",{type:"checkbox",class:"rounded text-primary focus:ring-primary border-gray-300",checked:n.value.includes(a.id),onChange:g=>r(a.id)},null,40,fe)]),e("td",he,[e("a",{onClick:g=>s.$emit("view",a.id),class:"hover:text-primary cursor-pointer",title:a.title},x(a.title),9,_e)]),e("td",we,[v(Q,{status:a.statusType,text:a.statusText},null,8,["status","text"])]),e("td",be,[v(W,{priority:a.priorityLevel,text:a.priority},null,8,["priority","text"])]),e("td",ke,[e("span",{title:a.sourceType+(a.sourceDetail?"："+a.sourceDetail:"")},x(a.sourceType)+x(a.sourceDetail?"："+a.sourceDetail:""),9,qe)]),e("td",$e,x(_(a.createTime)),1),e("td",Se,x(_(a.planTime)),1),e("td",Ce,[e("div",Re,[e("a",{onClick:g=>s.$emit("view",a.id),class:"!rounded-button p-1 text-gray-500 hover:text-primary tooltip cursor-pointer"},t[9]||(t[9]=[e("i",{class:"fas fa-eye text-xs"},null,-1),e("span",{class:"tooltiptext"},"查看详情",-1)]),8,Te),e("a",{onClick:g=>s.$emit("edit",a.id),class:"!rounded-button p-1 text-gray-500 hover:text-primary tooltip cursor-pointer"},t[10]||(t[10]=[e("i",{class:"fas fa-edit text-xs"},null,-1),e("span",{class:"tooltiptext"},"编辑需求",-1)]),8,De),e("button",{onClick:g=>s.$emit("delete",a.id),class:"!rounded-button p-1 text-gray-500 hover:text-danger tooltip cursor-pointer"},t[11]||(t[11]=[e("i",{class:"fas fa-trash text-xs"},null,-1),e("span",{class:"tooltiptext"},"删除需求",-1)]),8,Pe)])])]))),128))])])]))}});const Ve=P(Be,[["__scopeId","data-v-e20e112d"]]),Ee={class:"max-w-[1440px] mx-auto px-6 pt-24 pb-12"},Fe={class:"mt-8 flex justify-center"},Me=D({__name:"RequirementPoolPage",setup(f){const h=z(),m=p(H),o=p([]),n=p(!1),y=p(0),c=p(1),r=p(10),_=p([]),s=p({keyword:"",status:"",priority:"",sourceType:""}),t=async()=>{n.value=!0;try{const l={...s.value,pageNum:c.value,pageSize:r.value};Object.keys(l).forEach(b=>{l[b]===""&&delete l[b]});const d=await X(l);d.code===200&&d.data?(o.value=d.data.list,y.value=d.data.total):(w.error(d.message||"获取需求列表失败"),o.value=[],y.value=0)}catch(l){w.error(l.message||"获取需求列表失败"),o.value=[],y.value=0}finally{n.value=!1}},a=l=>{s.value={...l},c.value=1,t()},g=()=>{s.value={keyword:"",status:"",priority:"",sourceType:""},c.value=1,t()},C=l=>{c.value=l,t()},E=l=>{_.value=l},F=l=>{h.push(`/requirement-detail/${l}`)},M=l=>{h.push(`/requirement-edit/${l}`)},N=async l=>{try{await A.confirm("确定要删除此需求吗？此操作不可恢复。","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),n.value=!0;const d=await Z(l);d.code===200?(w.success("删除成功"),o.value.length===1&&c.value>1&&(c.value-=1),t()):w.error(d.message||"删除失败")}catch(d){d!=="cancel"&&w.error(d.message||"删除操作失败")}finally{n.value=!1}};return V([s,c],t,{deep:!0}),j(()=>{t()}),(l,d)=>{const b=B("el-pagination");return i(),u("div",null,[v(K,{activeMenu:"/requirement-pool",user:m.value},null,8,["user"]),e("main",Ee,[v(ie,{onSearch:a,onReset:g}),v(Ve,{requirements:o.value,loading:n.value,onView:F,onEdit:M,onDelete:N,onSelect:E},null,8,["requirements","loading"]),e("div",Fe,[v(b,{background:"",layout:"prev, pager, next, total",total:y.value,"current-page":c.value,"page-size":r.value,onCurrentChange:C},null,8,["total","current-page","page-size"])])]),v(J,{copyright:"© 2024 金融资讯智能跟踪平台. All rights reserved."})])}}});const Ae=P(Me,[["__scopeId","data-v-60d4ae75"]]);export{Ae as default};

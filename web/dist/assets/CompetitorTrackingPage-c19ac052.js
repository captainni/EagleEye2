import{_ as I,N as j}from"./axios-c1489369.js";import{_ as A,d as B,e as U,f as q,g as E}from"./defaultData-fb71e1fd.js";import{d as C,m as v,c as i,a as e,p as O,x as M,v as F,F as x,l as w,b as z,o as l,t as g,y as R,k as S,r as L,n as N,g as V,e as _,w as K,E as T,f as G,i as H,j as J,u as P}from"./index-095c05da.js";import{a as Q}from"./requirementService-f5232c39.js";import{g as W}from"./competitor-7629975a.js";import"./axiosInstance-4195a5ae.js";import"./request-211124dc.js";const X={class:"bg-white rounded-lg shadow-sm p-6 mb-6"},Y={class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 items-end"},Z={class:"col-span-1 md:col-span-3 lg:col-span-2"},ee=["value"],te=["value"],oe=["value"],re=C({__name:"CompetitorFilter",props:{competitorOptions:{},typeOptions:{},timeOptions:{}},emits:["filter"],setup(b,{emit:f}){const a=b,m=f,p=v(""),c=v(a.competitorOptions[0]),y=v(a.typeOptions[0]),n=v(a.timeOptions[0]),o=()=>{m("filter",{keyword:p.value,company:c.value,type:y.value,time:n.value})},r=()=>{p.value="",c.value=a.competitorOptions[0],y.value=a.typeOptions[0],n.value=a.timeOptions[0],o()};return(s,t)=>(l(),i("div",X,[e("div",Y,[e("div",Z,[t[4]||(t[4]=e("label",{for:"searchKeyword",class:"block text-sm font-medium text-gray-700 mb-1"},"关键词搜索",-1)),O(e("input",{type:"text",id:"searchKeyword","onUpdate:modelValue":t[0]||(t[0]=u=>p.value=u),placeholder:"输入动态标题、内容或竞品名称",class:"w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm",onInput:o},null,544),[[M,p.value]])]),e("div",null,[t[5]||(t[5]=e("label",{for:"competitorName",class:"block text-sm font-medium text-gray-700 mb-1"},"竞品机构",-1)),O(e("select",{id:"competitorName","onUpdate:modelValue":t[1]||(t[1]=u=>c.value=u),class:"w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm bg-white",onChange:o},[(l(!0),i(x,null,w(s.competitorOptions,(u,h)=>(l(),i("option",{key:h,value:u},g(u),9,ee))),128))],544),[[F,c.value]])]),e("div",null,[t[6]||(t[6]=e("label",{for:"dynamicType",class:"block text-sm font-medium text-gray-700 mb-1"},"动态类型",-1)),O(e("select",{id:"dynamicType","onUpdate:modelValue":t[2]||(t[2]=u=>y.value=u),class:"w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm bg-white",onChange:o},[(l(!0),i(x,null,w(s.typeOptions,(u,h)=>(l(),i("option",{key:h,value:u},g(u),9,te))),128))],544),[[F,y.value]])]),e("div",null,[t[7]||(t[7]=e("label",{for:"timeRange",class:"block text-sm font-medium text-gray-700 mb-1"},"时间范围",-1)),O(e("select",{id:"timeRange","onUpdate:modelValue":t[3]||(t[3]=u=>n.value=u),class:"w-full px-3 py-2 border border-gray-300 rounded-button focus:ring-primary focus:border-primary text-sm bg-white",onChange:o},[(l(!0),i(x,null,w(s.timeOptions,(u,h)=>(l(),i("option",{key:h,value:u},g(u),9,oe))),128))],544),[[F,n.value]])]),t[10]||(t[10]=e("div",{class:"hidden lg:block"},null,-1)),t[11]||(t[11]=e("div",{class:"hidden lg:block"},null,-1)),t[12]||(t[12]=e("div",{class:"hidden lg:block"},null,-1)),e("div",{class:"flex space-x-3 col-span-1 lg:col-span-2 justify-end"},[e("button",{class:"!rounded-button px-4 py-2 border border-gray-300 text-gray-600 hover:border-primary hover:text-primary text-sm whitespace-nowrap",onClick:r},t[8]||(t[8]=[e("i",{class:"fas fa-undo mr-1"},null,-1),z(" 重置 ")])),e("button",{class:"!rounded-button px-4 py-2 bg-primary text-white hover:bg-primary/90 text-sm whitespace-nowrap",onClick:o},t[9]||(t[9]=[e("i",{class:"fas fa-search mr-1"},null,-1),z(" 查询 ")]))])])]))}});const se=I(re,[["__scopeId","data-v-578dbd0d"]]),ae={class:"bg-white rounded-lg shadow-sm p-6 card-hover flex flex-col"},le={class:"flex items-center justify-between text-xs text-gray-500 mb-3"},ne={class:"font-medium text-gray-600"},ie={class:"flex flex-wrap gap-2 mb-3"},pe={class:"text-sm text-gray-600 mb-4 flex-grow"},ue={class:"flex justify-end space-x-3 mt-auto pt-4 border-t border-gray-100"},ce=C({__name:"CompetitorCard",props:{competitor:{}},setup(b){const f=R(),a=b,m=S(()=>a.competitor.company||a.competitor.competitor||"未知竞品"),p=S(()=>a.competitor.captureTime||a.competitor.publishTime||a.competitor.publishDate||"未知"),c=()=>{f.push({name:"CompetitorDetail",params:{id:a.competitor.id}})},y=async()=>{var n,o;if(!a.competitor.id){T.error("无法获取竞品ID");return}try{const r=Number(a.competitor.id);if(isNaN(r)){T.error("无效的竞品ID");return}await Q(r),T.success("需求已成功转化！")}catch(r){console.error("Error converting competitor to requirement:",r),T.error(((o=(n=r.response)==null?void 0:n.data)==null?void 0:o.message)||"需求转化失败，请稍后重试")}};return(n,o)=>{const r=L("router-link");return l(),i("div",ae,[e("h4",{class:"text-base font-semibold text-gray-800 mb-2 hover:text-primary cursor-pointer",onClick:c},g(n.competitor.title),1),e("div",le,[e("div",null,[e("span",ne,"竞品："+g(m.value),1),o[0]||(o[0]=e("span",{class:"mx-2"},"|",-1)),e("span",null,"类型："+g(n.competitor.type||"未知"),1)]),e("span",null,"捕获时间："+g(p.value),1)]),e("div",ie,[Array.isArray(n.competitor.tags)?(l(),i(x,{key:0},[n.competitor.tags.length>0&&typeof n.competitor.tags[0]=="object"?(l(!0),i(x,{key:0},w(n.competitor.tags,(s,t)=>(l(),i("span",{key:t,class:N(["px-2 py-0.5 text-xs font-medium rounded-full",`bg-${s.color}-100 text-${s.color}-600`])},g(s.label),3))),128)):(l(!0),i(x,{key:1},w(n.competitor.tags,(s,t)=>(l(),i("span",{key:t,class:"px-2 py-0.5 text-xs font-medium rounded-full bg-blue-100 text-blue-600"},g(s),1))),128))],64)):V("",!0)]),e("p",pe,g(n.competitor.suggestion||n.competitor.summary||"暂无建议"),1),e("div",ue,[_(r,{to:{name:"CompetitorDetail",params:{id:n.competitor.id}},class:"!rounded-button text-sm text-primary hover:underline whitespace-nowrap cursor-pointer"},{default:K(()=>o[1]||(o[1]=[z(" 查看详情 ")])),_:1},8,["to"]),e("button",{class:"!rounded-button px-3 py-1 bg-primary text-white text-sm whitespace-nowrap hover:bg-primary/90",onClick:y}," 转为需求 ")])])}}});const me=I(ce,[["__scopeId","data-v-c85644c9"]]),de={key:0,class:"col-span-1 lg:col-span-2 text-center py-12"},ye={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ge={key:0,class:"col-span-1 lg:col-span-2 text-center py-12"},ve=C({__name:"CompetitorList",props:{competitors:{type:Array,required:!0,default:()=>[]},loading:{type:Boolean,default:!1}},setup(b){return(f,a)=>(l(),i("div",null,[b.loading?(l(),i("div",de,a[0]||(a[0]=[e("i",{class:"fas fa-spinner fa-spin text-gray-300 text-4xl mb-4"},null,-1),e("p",{class:"text-gray-500"},"加载中...",-1)]))):(l(),i("div",ye,[(l(!0),i(x,null,w(b.competitors,m=>(l(),G(me,{key:m.id,competitor:m},null,8,["competitor"]))),128)),b.competitors.length===0?(l(),i("div",ge,a[1]||(a[1]=[e("i",{class:"fas fa-search text-gray-300 text-4xl mb-4"},null,-1),e("p",{class:"text-gray-500"},"暂无符合条件的竞品动态",-1)]))):V("",!0)]))]))}}),be={class:"mt-8 flex justify-center"},fe={"aria-label":"Page navigation"},xe={class:"inline-flex items-center -space-x-px"},he={key:0,class:"py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300"},we=["onClick"],ke=C({__name:"CompetitorPagination",props:{total:{},pageSize:{},currentPage:{}},emits:["update:currentPage"],setup(b,{emit:f}){const a=b,m=f,p=v(a.currentPage),c=S(()=>Math.ceil(a.total/a.pageSize));H(()=>a.currentPage,o=>{p.value=o});const y=o=>{o<1||o>c.value||(p.value=o,m("update:currentPage",o))},n=S(()=>{const o=[],r=c.value,s=p.value;if(r<=7)for(let t=1;t<=r;t++)o.push(t);else o.push(1),s<=3?o.push(2,3,4,5,"...",r):s>=r-2?o.push("...",r-4,r-3,r-2,r-1,r):o.push("...",s-1,s,s+1,"...",r);return o});return(o,r)=>(l(),i("div",be,[e("nav",fe,[e("ul",xe,[e("li",null,[e("a",{onClick:r[0]||(r[0]=s=>p.value>1&&y(p.value-1)),class:N(["py-2 px-3 ml-0 leading-tight text-gray-500 bg-white rounded-l-button border border-gray-300 cursor-pointer",p.value===1?"opacity-50 cursor-not-allowed":"hover:bg-gray-100 hover:text-gray-700"])},r[2]||(r[2]=[e("span",{class:"sr-only"},"Previous",-1),e("i",{class:"fas fa-chevron-left text-xs"},null,-1)]),2)]),(l(!0),i(x,null,w(n.value,s=>(l(),i("li",{key:s},[s==="..."?(l(),i("a",he," ... ")):(l(),i("a",{key:1,onClick:t=>y(Number(s)),class:N(["py-2 px-3 leading-tight border border-gray-300 cursor-pointer",p.value===s?"text-primary bg-blue-50 hover:bg-blue-100 hover:text-primary z-10":"text-gray-500 bg-white hover:bg-gray-100 hover:text-gray-700"])},g(s),11,we))]))),128)),e("li",null,[e("a",{onClick:r[1]||(r[1]=s=>p.value<c.value&&y(p.value+1)),class:N(["py-2 px-3 leading-tight text-gray-500 bg-white rounded-r-button border border-gray-300 cursor-pointer",p.value===c.value?"opacity-50 cursor-not-allowed":"hover:bg-gray-100 hover:text-gray-700"])},r[3]||(r[3]=[e("span",{class:"sr-only"},"Next",-1),e("i",{class:"fas fa-chevron-right text-xs"},null,-1)]),2)])])])]))}}),_e={class:"max-w-[1440px] mx-auto px-6 pt-24 pb-12"},Se=C({__name:"CompetitorTrackingPage",setup(b){const f=v(6),a=v(1),m=v(0),p=v(!1),c=v([]),y=B,n=U,o=q,r=E,s=v({keyword:"",company:n[0],type:o[0],time:r[0]}),t=async()=>{p.value=!0;try{const d={pageNum:a.value,pageSize:f.value};if(s.value.keyword&&(d.keyword=s.value.keyword),s.value.company!==n[0]&&(d.competitor=s.value.company),s.value.type!==o[0]&&(d.type=s.value.type),s.value.time!==r[0]){const $=new Date;let D=new Date;switch(s.value.time){case"近7天":D.setDate($.getDate()-7);break;case"近30天":D.setDate($.getDate()-30);break;case"近90天":D.setDate($.getDate()-90);break}d.publishTimeStart=D.toISOString().split("T")[0],d.publishTimeEnd=$.toISOString().split("T")[0]}const k=await W(d);k&&typeof k=="object"?(c.value=k.list||[],m.value=k.total||0):(console.warn("获取竞品列表响应格式不符预期:",k),c.value=[],m.value=0)}catch(d){console.error("获取竞品列表失败:",d),c.value=[],m.value=0}finally{p.value=!1}},u=d=>{s.value=d,a.value=1,t()},h=d=>{a.value=d,t()};return J(()=>{t()}),(d,k)=>(l(),i("div",null,[_(j,{"active-menu":"/competitor-tracking",user:P(y)},null,8,["user"]),e("main",_e,[_(se,{"competitor-options":P(n),"type-options":P(o),"time-options":P(r),onFilter:u},null,8,["competitor-options","type-options","time-options"]),_(ve,{competitors:c.value,loading:p.value},null,8,["competitors","loading"]),_(ke,{total:m.value,"page-size":f.value,"current-page":a.value,"onUpdate:currentPage":h},null,8,["total","page-size","current-page"])]),_(A,{copyright:"© 2024 金融资讯智能跟踪平台. All rights reserved."})]))}});export{Se as default};
